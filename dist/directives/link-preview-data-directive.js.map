{"version":3,"file":"link-preview-data-directive.js","sourceRoot":"","sources":["../../src/directives/link-preview-data-directive.ts"],"names":[],"mappings":"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","sourcesContent":["import {PropertyValues} from 'lit';\nimport {property, state} from 'lit/decorators.js';\nimport {LinkPreviewData} from '../lib/domain/models/link-preview-data';\nimport {AnchorElementDataDirective} from './anchor-element-data.directive';\nimport {urlToOrigin} from '../lib/util/url-helper';\nimport {\n  ApiError,\n  fetchLinkPreviewData,\n  isSuccessResponse,\n} from '../lib/services/api-fetcher';\n\n/**\n * Directive that either fetches link preview data from an external URL or uses manually set properties.\n */\nexport class LinkPreviewDataDirective extends AnchorElementDataDirective {\n  /**\n   *\n   * If the href is not provided, the url will be used to fetch the link preview data.\n   */\n  @property()\n  url: string | null = null;\n\n  /**\n   * A manually set title for the link preview.\n   */\n  @property()\n  override title: string = '';\n\n  /**\n   * A manually set description for the link preview.\n   */\n  @property()\n  description: string | null = null;\n\n  /**\n   * A manually set author for the link preview.\n   */\n  @property()\n  author: string | null = null;\n\n  /**\n   * A manually set image URL for the link preview.\n   */\n  @property()\n  imageUrl: string | null = null;\n\n  /**\n   * A manually set image alt text for the link preview.\n   */\n  @property()\n  imageAlt: string | null = null;\n\n  /**\n   * A manually set favicon URL for the link preview.\n   *\n   * If not provided, a fallback favicon will be used.\n   */\n  @property()\n  faviconUrl: string | null = null;\n\n  /**\n   * A manually set date for the link preview.\n   */\n  @property()\n  date: string | null = null;\n\n  /**\n   * If set to true, the Powered by Previewbox info will not be shown.\n   */\n  @property()\n  hidePoweredBy: string | undefined = undefined;\n\n  /**\n   * The URL of the API to fetch the link preview data from.\n   *\n   * Defaults to the Previewbox API.\n   */\n  @property()\n  apiUrl: string = window.location.origin.startsWith(\n    'http://localhost:8080/demo'\n  )\n    ? 'http://localhost:4444/v1/meta'\n    : 'https://previewbox.link/api/v1/meta';\n\n  @state()\n  protected fetchedLinkPreviewData: LinkPreviewData | null = null;\n\n  @state()\n  protected _isLoading = false;\n\n  @state()\n  protected _isError = false;\n\n  @state()\n  protected _apiError: ApiError | null = null;\n\n  protected get linkData(): LinkPreviewData {\n    if (this.fetchedLinkPreviewData) {\n      return this.fetchedLinkPreviewData;\n    }\n    return {\n      url: this.url,\n      description: this.description,\n      title: this.title,\n      author: this.author,\n      imageUrl: this.imageUrl,\n      imageAlt: this.imageAlt,\n      favicon: this.faviconUrl,\n      date: this.date,\n      origin: urlToOrigin(this.url),\n    };\n  }\n\n  protected override firstUpdated(_changedProperties: PropertyValues): void {\n    if (!this.href && !this.url) {\n      throw new Error(`No href or url provided for ${this.localName}`);\n    }\n    if (this.href) {\n      this._fetchLinkPreviewData();\n    } else {\n      this._setManualData();\n    }\n  }\n\n  private _fetchLinkPreviewData(): void {\n    this._isLoading = true;\n    fetchLinkPreviewData(this.href, {apiUrl: this.apiUrl})\n      .then((response) => {\n        if (isSuccessResponse(response)) {\n          this.fetchedLinkPreviewData = response.data;\n        } else {\n          this._isError = true;\n          this._apiError = response.error;\n        }\n      })\n      .catch((error) => {\n        console.error(\n          `Error fetching link preview data for ${this.href}: ${error}`\n        );\n        this._isError = true;\n        this._apiError = ApiError.UNKNOWN_ERROR;\n      })\n      .finally(() => {\n        this._isLoading = false;\n      });\n  }\n\n  private _setManualData(): void {\n    if (!this.url) {\n      throw new Error(\n        `As no href was provided, url is required for ${this.localName}`\n      );\n    }\n    this.fetchedLinkPreviewData = {\n      url: this.url,\n      description: this.description,\n      title: this.title,\n      author: this.author,\n      imageUrl: this.imageUrl,\n      imageAlt: this.imageAlt,\n      favicon: this.faviconUrl,\n      date: this.date,\n      origin: urlToOrigin(this.url),\n    };\n  }\n}\n"]}